<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Sondes.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Sondes.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file Sondes.jsx
 * @description Composant React d'affichage des mesures de sondes.
 *              Il récupère les données depuis une API, filtre pour ne garder que
 *              la dernière mesure reçue de chaque sonde, et les affiche dans un tableau.
 */

import { useEffect, useState } from "react"
import "./Sondes.css"

/**
 * Composant principal d'affichage des sondes.
 *
 * @component
 * @example
 * // Exemple d'utilisation :
 * &lt;Sondes />
 *
 * @returns {JSX.Element} Tableau listant les dernières mesures reçues des sondes.
 */
export default function Sondes() {
    /**
     * État local contenant la liste des mesures affichées.
     * Chaque élément est un objet du type :
     * {
     *   _id: string,
     *   device_id: string,
     *   haut: number,
     *   volt: number,
     *   received_at: string (ISO date)
     * }
     */
    const [data, setData] = useState([])

    /** URL de base de l’API, définie dans le fichier `.env` via la variable VITE_URL_API */
    const apiUrl = import.meta.env.VITE_URL_API

    /**
     * Effet de récupération des données lors du montage du composant.
     *
     * - Appelle l'API `${apiUrl}/sondes`
     * - Si la réponse est un succès (`json.success === true`),
     *   filtre les données pour ne garder que la dernière mesure reçue
     *   pour chaque sonde (`device_id` unique)
     * - Met à jour le state `data` avec ces dernières valeurs.
     */
    useEffect(() => {
        fetch(`${apiUrl}/sondes`)
            .then((res) => res.json())
            .then((json) => {
                if (json.success) {
                    // Réduction : ne garder que la mesure la plus récente par sonde
                    const latest = Object.values(
                        json.data.reduce((acc, item) => {
                            const id = item.device_id
                            // Si la sonde n’existe pas encore ou si la mesure est plus récente, on remplace
                            if (!acc[id] || new Date(item.received_at) > new Date(acc[id].received_at)) {
                                acc[id] = item
                            }
                            return acc
                        }, {})
                    )
                    setData(latest)
                }
            })
            .catch((err) => console.error("Erreur lors de la récupération des sondes :", err))
    }, [apiUrl]) // dépendance sur apiUrl (bonne pratique même si souvent stable)

    /**
     * Rendu JSX :
     * - Affiche un titre
     * - Table HTML listant les mesures récentes
     * - Chaque ligne correspond à une sonde (identifiée par `_id`)
     */
    return (
        &lt;div className="container">
            &lt;h2 className="title">Mesures des sondes&lt;/h2>

            &lt;div className="table-wrap">
                &lt;table className="table">
                    &lt;thead>
                        &lt;tr>
                            &lt;th>Pont&lt;/th>
                            &lt;th>Hauteur (m)&lt;/th>
                            &lt;th>Tension (V)&lt;/th>
                            &lt;th>Date de réception&lt;/th>
                        &lt;/tr>
                    &lt;/thead>

                    &lt;tbody>
                        {data.map(({ _id, device_id, haut, volt, received_at }) => (
                            &lt;tr key={_id}>
                                &lt;td>{device_id}&lt;/td>
                                &lt;td className="num">{haut}&lt;/td>
                                &lt;td className="num">{volt}&lt;/td>
                                &lt;td className="nowrap">
                                    {new Date(received_at).toLocaleString("fr-FR")}
                                &lt;/td>
                            &lt;/tr>
                        ))}
                    &lt;/tbody>
                &lt;/table>
            &lt;/div>
        &lt;/div>
    )
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Wed Oct 22 2025 12:46:08 GMT+0200 (heure d’été d’Europe centrale)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
